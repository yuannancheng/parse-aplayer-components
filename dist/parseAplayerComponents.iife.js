var parseAplayerComponents=function(R,C){"use strict";const p=(e,n)=>{if(n.length>2)return n[0]in e||(e[n[0]]={}),p(e[n[0]],n.slice(1));const o=P(n[0]),s=x(n[1]);e[o]=s},P=e=>e.replace(/\-(\w)/g,function(n,o){return o.toUpperCase()}),x=e=>/true|false/.test(e)?e!=="false":e!==""&&isFinite(e)?1*e:e,A=e=>(e=e.split("#")[0],e.substring(0,e.lastIndexOf("/")+1)),S=(e,n)=>{var o=new URL(n,e);return o.href},u=(e,n)=>(n?n=A(n):n=window.location.href,S(n,e)),O=(e,n,o)=>new Promise((s,r)=>{var t=new XMLHttpRequest;t.open(n,e,!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=function(){t.readyState==4&&t.status==200?s(JSON.parse(t.responseText)):t.readyState==4&&r(new Error(t.statusText))},t.send(JSON.stringify(o))}),y=async e=>new Promise(async n=>{try{const o=await O(e,"GET");n(o)}catch{console.error(`请求"${e}"过程中发生错误`),n({})}}),g=async(e,n,o=null)=>new Promise(async s=>{if(e===void 0||e===""||!e.endsWith(".json"))return s({});const r=u(e,o);o=r;const t=await y(r),i=n&&!t.audio,c={...await g(t.extends,i,o),...t};if(n){const l=await w(c,c.audio,o);c.audio=l}delete c.extends,s(c)});async function w(e,n,o=null){return new Promise(async s=>{if(n===void 0)return s([]);const r=[];for(const t of n)if(typeof t=="string"){if(t===""||!t.endsWith(".json"))return s();const i=u(t,o),a=i,c=await y(i);if(Object.keys(c).length===0)return s();const l=await w(e,c.audio,a);l.forEach(f=>{h(e,f,a)}),r.push(...l)}else h(e,t,o),r.push(t);s(r)})}function h(e,n,o){const s=["url","cover"];e.lrcType===3&&s.push("lrc");for(const r in n)n.hasOwnProperty(r)&&s.includes(r)&&(n[r]=u(n[r],o))}const E=(e,n,o)=>new Promise(async s=>{let r,t;const i=window.location.href&&window.location.href.split("#")[0];try{t=JSON.parse(sessionStorage.getItem("sessionConfig"))||{}}catch(a){console.log(a),t={}}if(t[i]&&t[i][o])r=t[i][o];else{const a={},c=e.attributes;for(let d=0;d<c.length;d++){const m=c[d];p(a,m.name.split(".").concat(m.value))}const l=!a.audio,f=await g(a.config,l);delete a.config,r={...f,...a},t[i]||(t[i]=[]),t[i][o]=r,sessionStorage.setItem("sessionConfig",JSON.stringify(t))}r.container=n,s(new C(r))});return async function(){const e=document.querySelectorAll("aplayer");for(let n=0;n<e.length;n++){const o=e[n],s=document.createElement("div");s.id="APlayer_"+Math.random().toString(36).slice(-7),o.parentElement.replaceChild(s,o),await E(o,s,n)}}()}(null,APlayer);
