(function(u,f){typeof exports=="object"&&typeof module<"u"?module.exports=f(require("aplayer/dist/APlayer.min.css"),require("aplayer")):typeof define=="function"&&define.amd?define(["aplayer/dist/APlayer.min.css","aplayer"],f):(u=typeof globalThis<"u"?globalThis:u||self,u.parseAplayerComponents=f(null,u.APlayer))})(this,function(u,f){"use strict";const g=(e,n)=>{if(n.length>2)return n[0]in e||(e[n[0]]={}),g(e[n[0]],n.slice(1));const s=x(n[0]),o=A(n[1]);e[s]=o},x=e=>e.replace(/\-(\w)/g,function(n,s){return s.toUpperCase()}),A=e=>/true|false/.test(e)?e!=="false":e!==""&&isFinite(e)?1*e:e,S=e=>(e=e.split("#")[0],e.substring(0,e.lastIndexOf("/")+1)),O=(e,n)=>{var s=new URL(n,e);return s.href},d=(e,n)=>(n?n=S(n):n=window.location.href,O(n,e)),T=(e,n,s)=>new Promise((o,i)=>{var t=new XMLHttpRequest;t.open(n,e,!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=function(){t.readyState==4&&t.status==200?o(JSON.parse(t.responseText)):t.readyState==4&&i(new Error(t.statusText))},t.send(JSON.stringify(s))}),h=async e=>new Promise(async n=>{try{const s=await T(e,"GET");n(s)}catch{console.error(`请求"${e}"过程中发生错误`),n({})}}),m=async(e,n,s=null)=>new Promise(async o=>{if(e===void 0||e===""||!e.endsWith(".json"))return o({});const i=d(e,s);s=i;const t=await h(i),r=n&&!t.audio,c={...await m(t.extends,r,s),...t};if(n){const l=await w(c,c.audio,s);c.audio=l}delete c.extends,o(c)});async function w(e,n,s=null){return new Promise(async o=>{if(n===void 0)return o([]);const i=[];for(const t of n)if(typeof t=="string"){if(t===""||!t.endsWith(".json"))return o();const r=d(t,s),a=r,c=await h(r);if(Object.keys(c).length===0)return o();const l=await w(e,c.audio,a);l.forEach(p=>{C(e,p,a)}),i.push(...l)}else C(e,t,s),i.push(t);o(i)})}function C(e,n,s){const o=["url","cover"];e.lrcType===3&&o.push("lrc");for(const i in n)n.hasOwnProperty(i)&&o.includes(i)&&(n[i]=d(n[i],s))}const j=(e,n,s)=>new Promise(async o=>{let i,t;const r=window.location.href&&window.location.href.split("#")[0];try{t=JSON.parse(sessionStorage.getItem("sessionConfig"))||{}}catch(a){console.log(a),t={}}if(t[r]&&t[r][s])i=t[r][s];else{const a={},c=e.attributes;for(let y=0;y<c.length;y++){const P=c[y];g(a,P.name.split(".").concat(P.value))}const l=!a.audio,p=await m(a.config,l);delete a.config,i={...p,...a},t[r]||(t[r]=[]),t[r][s]=i,sessionStorage.setItem("sessionConfig",JSON.stringify(t))}i.container=n,o(new f(i))});return async function(){const e=document.querySelectorAll("aplayer");for(let n=0;n<e.length;n++){const s=e[n],o=document.createElement("div");o.id="APlayer_"+Math.random().toString(36).slice(-7),s.parentElement.replaceChild(o,s),await j(s,o,n)}}()});
